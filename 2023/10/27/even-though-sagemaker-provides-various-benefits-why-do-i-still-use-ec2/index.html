<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"kennychen.frontiertechcap.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IntroductionIn the previous article, I explained the benefits of using Sagemaker for training models on a local server, which can be found in the article “Why Choose Sagemaker Despite Having a Local S">
<meta property="og:type" content="article">
<meta property="og:title" content="Even though Sagemaker provides various benefits, why do I still use EC2?">
<meta property="og:url" content="https://kennychen.frontiertechcap.com/2023/10/27/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/index.html">
<meta property="og:site_name" content="AWS Sagemaker Blog">
<meta property="og:description" content="IntroductionIn the previous article, I explained the benefits of using Sagemaker for training models on a local server, which can be found in the article “Why Choose Sagemaker Despite Having a Local S">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://kennychen.frontiertechcap.com/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/training-and-deploying-models-locally.png">
<meta property="og:image" content="https://kennychen.frontiertechcap.com/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/dataset-001.jpg">
<meta property="og:image" content="https://kennychen.frontiertechcap.com/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/postman-001.png">
<meta property="og:image" content="https://kennychen.frontiertechcap.com/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/batch-transform-endpoint.png">
<meta property="og:image" content="https://kennychen.frontiertechcap.com/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/real-time-endpoint.png">
<meta property="og:image" content="https://kennychen.frontiertechcap.com/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/benefits-001.png">
<meta property="article:published_time" content="2023-10-26T16:00:00.000Z">
<meta property="article:modified_time" content="2023-10-26T16:00:00.000Z">
<meta property="article:author" content="Kenny Chen">
<meta property="article:tag" content="AWS, Segemaker, Machine Learning, Trading Strategies">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kennychen.frontiertechcap.com/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/training-and-deploying-models-locally.png">

<link rel="canonical" href="https://kennychen.frontiertechcap.com/2023/10/27/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Even though Sagemaker provides various benefits, why do I still use EC2? | AWS Sagemaker Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">AWS Sagemaker Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Machine Learning for Financial Services and Trading Strategies</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://kennychen.frontiertechcap.com/2023/10/27/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon/ic_avatar_001.jpg">
      <meta itemprop="name" content="Kenny Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AWS Sagemaker Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Even though Sagemaker provides various benefits, why do I still use EC2?
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-10-27 00:00:00" itemprop="dateCreated datePublished" datetime="2023-10-27T00:00:00+08:00">2023-10-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Sagemaker/" itemprop="url" rel="index"><span itemprop="name">Sagemaker</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Sagemaker/Machine-Learning/" itemprop="url" rel="index"><span itemprop="name">Machine Learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In the previous article, I explained the benefits of using Sagemaker for training models on a local server, which can be found in the article “<a href="/blog.aws/2023/09/13/why-choose-sagemaker-despite-having-a-local-server-with-rtx3080/">Why Choose Sagemaker Despite Having a Local Server with RTX3080?</a>“.</p>
<p>In this article, I will first present a simple example to demonstrate the process of training and deploying models locally using Sagemaker.</p>
<p>Then, I will share my experience with a LSTM futures trading project to explain the best practices for using real-time endpoints and batch-transform endpoints.</p>
<p>Finally, based on my experience with the LSTM futures trading project, I will explain which Sagemaker Instance &#x2F; Fargate &#x2F; EC2 should be selected for deployment.</p>
<h2 id="Sagemaker-Exec-Training-and-Deploying-Models-Locally"><a href="#Sagemaker-Exec-Training-and-Deploying-Models-Locally" class="headerlink" title="Sagemaker Exec - Training and Deploying Models Locally"></a>Sagemaker Exec - Training and Deploying Models Locally</h2><p><img src="/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/training-and-deploying-models-locally.png" alt="Sagemaker Exec - Training and Deploying Models Locally"></p>
<p><strong>0.0 Prerequisite:</strong><br>Before starting local development, please install the following:</p>
<ul>
<li>Nvidia CUDA (<a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a>)</li>
<li>Nvidia-container-toolkit (<a target="_blank" rel="noopener" href="https://github.com/NVIDIA/nvidia-container-toolkit">https://github.com/NVIDIA/nvidia-container-toolkit</a>)</li>
<li>Docker (<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/">https://docs.docker.com/engine/install/</a>)</li>
</ul>
<p><strong>1.0 Install Docker Local Development Image</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># Copyright (c) Jupyter Development Team.</span><br><span class="line"># Distributed under the terms of the Modified BSD License.</span><br><span class="line">ARG REGISTRY=quay.io</span><br><span class="line">ARG OWNER=jupyter</span><br><span class="line">ARG BASE_CONTAINER=$REGISTRY/$OWNER/scipy-notebook</span><br><span class="line">FROM $BASE_CONTAINER</span><br><span class="line"></span><br><span class="line">USER root</span><br><span class="line"></span><br><span class="line">LABEL maintainer=&quot;Jupyter Project &lt;jupyter@googlegroups.com&gt;&quot;</span><br><span class="line"></span><br><span class="line">RUN apt-get -y update &amp;&amp; apt-get install -y --no-install-recommends \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl  \</span><br><span class="line">    gnupg</span><br><span class="line">RUN install  -m 0755 -d /etc/apt/keyrings</span><br><span class="line">RUN curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br><span class="line">RUN chmod a+r /etc/apt/keyrings/docker.gpg</span><br><span class="line">RUN echo \</span><br><span class="line">  &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \</span><br><span class="line">  $(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;) stable&quot; | \</span><br><span class="line">  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line">RUN apt-get update</span><br><span class="line">RUN apt-get install -y \</span><br><span class="line">    docker-ce \</span><br><span class="line">    docker-ce-cli \</span><br><span class="line">    containerd.io \</span><br><span class="line">    docker-buildx-plugin \</span><br><span class="line">    docker-compose-plugin</span><br><span class="line"></span><br><span class="line"># Fix: https://github.com/hadolint/hadolint/wiki/DL4006</span><br><span class="line"># Fix: https://github.com/koalaman/shellcheck/wiki/SC3014</span><br><span class="line">SHELL [&quot;/bin/bash&quot;, &quot;-o&quot;, &quot;pipefail&quot;, &quot;-c&quot;]</span><br><span class="line"></span><br><span class="line"># Install Tensorflow with pip</span><br><span class="line">RUN pip install --no-cache-dir tensorflow[and-cuda] &amp;&amp; \</span><br><span class="line">    fix-permissions &quot;$&#123;CONDA_DIR&#125;&quot; &amp;&amp; \</span><br><span class="line">    fix-permissions &quot;/home/$&#123;NB_USER&#125;&quot;</span><br><span class="line"></span><br><span class="line"># Install sagemaker-python-sdk with pip</span><br><span class="line">RUN pip install --no-cache-dir &#x27;sagemaker[local]&#x27; --upgrade</span><br></pre></td></tr></table></figure>
<p>1.1 Use the <code>jupyter/tensorflow-notebook</code> development environment<br>(<a target="_blank" rel="noopener" href="https://github.com/jupyter/docker-stacks/blob/main/images/tensorflow-notebook/Dockerfile">https://github.com/jupyter/docker-stacks/blob/main/images/tensorflow-notebook/Dockerfile</a>)<br>1.2 Modify the <code>jupyter/tensorflow-notebook</code> image to install <code>docker</code> and <code>sagemaker[local]</code> inside the image</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t sagemaker/local:0.1 .</span><br></pre></td></tr></table></figure>
<p>1.3 Create the local development image</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --privileged --name jupyter.sagemaker.001 --gpus all -e GRANT_SUDO=yes --user root --network host -it -v /home/jovyan/work:/home/jovyan/work -v /sagemaker:/sagemaker -v /var/run/docker.sock:/var/run/docker.sock -v /tmp:/tmp -v /sagemaker:/sagemaker sagemaker/local:0.2 &gt;&gt; /home/jovyan/work/log/sagemaker_local_date +\%Y\%m\%d_\%H\%M\%S.log 2</span><br></pre></td></tr></table></figure>
<p>1.4 Start the local development image<br>1.5 <code>-v /home/jovyan/work</code>, this is the default path for jupyter&#x2F;tensorflow-notebook<br>1.6 <code>-v /var/run/docker.sock</code>, used to start the Sagemaker’s train &amp; inference image<br>1.7 <code>-v /tmp</code>, this is the temporary file path for Sagemaker<br>1.8 Go to <code>127.0.0.1:8888</code></p>
<p><strong>2.0 Sagemaker Local Training of Models</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">os.environ[&#x27;AWS_DEFAULT_REGION&#x27;] = &#x27;AWS_DEFAULT_REGION&#x27;</span><br><span class="line">os.environ[&#x27;AWS_ACCESS_KEY_ID&#x27;] = &#x27;AWS_ACCESS_KEY_ID&#x27;</span><br><span class="line">os.environ[&#x27;AWS_SECRET_ACCESS_KEY&#x27;] = &#x27;AWS_SECRET_ACCESS_KEY&#x27;</span><br><span class="line">os.environ[&#x27;AWS_ROLE&#x27;] = &#x27;AWS_ROLE&#x27;</span><br><span class="line">os.environ[&#x27;INSTANCE_TYPE&#x27;] = &#x27;local_gpu&#x27;</span><br></pre></td></tr></table></figure>
<p>2.1 Set AWS <code>IAM</code> and <code>INSTANCE_TYPE</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import keras</span><br><span class="line">import numpy as np</span><br><span class="line">from keras.datasets import fashion_mnist</span><br><span class="line"></span><br><span class="line">(x_train, y_train), (x_val, y_val) = fashion_mnist.load_data()</span><br><span class="line">os.makedirs(&quot;./data&quot;, exist_ok = True)</span><br><span class="line">np.savez(&#x27;./data/training&#x27;, image=x_train, label=y_train)</span><br><span class="line">np.savez(&#x27;./data/validation&#x27;, image=x_val, label=y_val)</span><br></pre></td></tr></table></figure>
<p>2.2 Download datasets (training set and validation set)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from sagemaker.tensorflow import TensorFlow</span><br><span class="line"></span><br><span class="line">training = &#x27;file://data&#x27;</span><br><span class="line">validation = &#x27;file://data&#x27;</span><br><span class="line">output = &#x27;file:///tmp&#x27;</span><br><span class="line"></span><br><span class="line">tf_estimator = TensorFlow(entry_point=&#x27;fmnist.py&#x27;,</span><br><span class="line">                          source_dir=&#x27;./src&#x27;,</span><br><span class="line">                          role=os.environ[&#x27;AWS_ROLE&#x27;],</span><br><span class="line">                          instance_count=1, </span><br><span class="line">                          instance_type=os.environ[&#x27;INSTANCE_TYPE&#x27;],</span><br><span class="line">                          framework_version=&#x27;2.11&#x27;, </span><br><span class="line">                          py_version=&#x27;py39&#x27;,</span><br><span class="line">                          hyperparameters=&#123;&#x27;epochs&#x27;: 10&#125;,</span><br><span class="line">                          output_path=output,</span><br><span class="line">                         )</span><br><span class="line"></span><br><span class="line">tf_estimator.fit(&#123;&#x27;training&#x27;: training, &#x27;validation&#x27;: validation&#125;)</span><br></pre></td></tr></table></figure>
<p>2.3 Download <code>fmnist.py</code> and <code>model.py</code> to <code>./src</code><br>(<a target="_blank" rel="noopener" href="https://github.com/PacktPublishing/Learn-Amazon-SageMaker-second-edition/tree/main/Chapter%2007/tf">https://github.com/PacktPublishing/Learn-Amazon-SageMaker-second-edition/tree/main/Chapter%2007/tf</a>)<br>2.4 Start local training of models. Sagemaker launches the image <code>763104351884.dkr.ecr.us-east-1.amazonaws.com/tensorflow-training:2.11-gpu-py39</code>.</p>
<p><strong>3.0 Sagemaker Local Deployment of Models</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">from sagemaker.tensorflow import TensorFlowModel</span><br><span class="line"></span><br><span class="line">model = TensorFlowModel(</span><br><span class="line">    entry_point=&#x27;inference.py&#x27;,</span><br><span class="line">    source_dir=&#x27;./src&#x27;,</span><br><span class="line">    role=os.environ[&#x27;AWS_ROLE&#x27;],</span><br><span class="line">    model_data=f&#x27;&#123;output&#125;/model.tar.gz&#x27;,</span><br><span class="line">    framework_version=&#x27;2.11&#x27;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">predictor = model.deploy(</span><br><span class="line">    initial_instance_count=1,</span><br><span class="line">    instance_type=os.environ[&#x27;INSTANCE_TYPE&#x27;],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>3.1 Download <code>inference.py</code> to <code>./src</code><br>(<a target="_blank" rel="noopener" href="https://github.com/aws/sagemaker-tensorflow-serving-container/blob/master/test/resources/examples/test1/inference.py">https://github.com/aws/sagemaker-tensorflow-serving-container/blob/master/test/resources/examples/test1/inference.py</a>)<br>3.2 Create the Tensorflow-serving image. Sagemaker launches the image <code>763104351884.dkr.ecr.us-east-1.amazonaws.com/tensorflow-inference:2.11-gpu</code></p>
<p><strong>4.0 Invoke the Tensorflow-Serving:8080 interface</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">import json</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">num_samples = 10</span><br><span class="line">indices = random.sample(range(x_val.shape[0] - 1), num_samples)</span><br><span class="line">images = x_val[indices]/255</span><br><span class="line">labels = y_val[indices]</span><br><span class="line"></span><br><span class="line">for i in range(num_samples):</span><br><span class="line">    plt.subplot(1,num_samples,i+1)</span><br><span class="line">    plt.imshow(images[i].reshape(28, 28), cmap=&#x27;gray&#x27;)</span><br><span class="line">    plt.title(labels[i])</span><br><span class="line">    plt.axis(&#x27;off&#x27;)</span><br><span class="line"></span><br><span class="line">payload = images.reshape(num_samples, 28, 28, 1)</span><br></pre></td></tr></table></figure>
<p><img src="/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/dataset-001.jpg" alt="Download datasets"><br>4.1 Download datasets</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">response = predictor.predict(payload)</span><br><span class="line">prediction = np.array(response[&#x27;predictions&#x27;])</span><br><span class="line">predicted_label = prediction.argmax(axis=1)</span><br><span class="line">print(&#x27;Predicted labels are: &#123;&#125;&#x27;.format(predicted_label))</span><br></pre></td></tr></table></figure>
<p>4.2 Run the model</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(&#x27;About to delete the endpoint&#x27;)</span><br><span class="line">predictor.delete_endpoint(predictor.endpoint_name)</span><br></pre></td></tr></table></figure>
<p>4.3 Close the Tensorflow-serving image</p>
<p><strong>5.0 External Invocation of Tensorflow-serving:8080 interface</strong></p>
<p><img src="/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/postman-001.png" alt="External Invocation of Tensorflow-serving:8080 interface"><br>5.1 Go to the real-time endpoint (<a target="_blank" rel="noopener" href="http://your-segamaker-domain:8080/invocations">http://YOUR-SEGAMAKER-DOMAIN:8080/invocations</a>)<br>5.2 [Post] Body -&gt; raw, input json data</p>
<p><strong>Conclusion of Sagemaker Exec</strong></p>
<p>This is a simple example demonstrating the process of training and deploying models locally using Sagemaker. As mentioned earlier, since Sagemaker does not fully support local development, it is necessary to modify the <code>jupyter/tensorflow-notebook</code> image. Additionally, a more complex <code>inference.py</code> is required for local model deployment.</p>
<p>However, I still recommend using Sagemaker for local development because it provides pre-built resources and clean code. Moreover, Sagemaker has preconfigured workflows for training and deploying model images, so we do not need to deeply understand the project structure and internal operations to complete the training and deployment of models.</p>
<h2 id="When-to-use-real-time-endpoints-and-batch-transform-endpoints"><a href="#When-to-use-real-time-endpoints-and-batch-transform-endpoints" class="headerlink" title="When to use real-time endpoints and batch-transform endpoints"></a>When to use real-time endpoints and batch-transform endpoints</h2><p>The choice of endpoint depends not only on cost factors but also on business logic, such as response time, frequency of Invocation, dataset size, model update frequency, error tolerance, etc. I will present two practical use cases to explain the best use of <code>real-time endpoints</code> and <code>batch-transform endpoints</code>.</p>
<blockquote>
<ul>
<li>SageMaker batch transform is designed to perform batch inference at scale and is cost-effective.</li>
<li>SageMaker real-time endpoints aim to provide a robust live hosting option for your ML use cases.</li>
</ul>
</blockquote>
<blockquote>
<p>Getting-Started-with-Amazon-SageMaker-Studio, chapter07</p>
</blockquote>
<p>Here are two examples of trading strategy:</p>
<p><strong>1. Diana’s medium-term quarterly trading strategy</strong><br>The multi-asset portfolio includes US stocks, overseas stocks, US coupon bonds, overseas high-yield bonds, and 3-month bills. Every 3 months, the LSTM-all-weather-portfolio model is used for asset rebalancing. This model runs once a day, 15 minutes before market close, to check the risk of each position and whether the portfolio meets the 5% annualized return.</p>
<p><strong>2. Alice’s intraday futures trading strategy</strong><br>Trading only S&amp;P 500 index and Nasdaq index futures, with a holding period of approximately 30 minutes to 360 minutes. The LSTM-Pure-Alpha-Future model uses 20-second snapshot data to provide buy and exit signals. These signals are stored for daily performance analysis of the model.</p>
<hr>
<p><strong>Diana’s Medium-Term Quarterly Trading Strategy</strong></p>
<ul>
<li><strong>Assets</strong>: Stocks, Bonds, Bills</li>
<li><strong>Instrument Pool</strong>: US stocks, Overseas stocks, US coupon bonds, Overseas high-yield bonds, 3-month bills</li>
<li><strong>Trading Frequency</strong>: 5 trades per quarter </li>
<li><strong>Response Time</strong>: Time Delayed. Only required 15 minutes before market close</li>
<li><strong>Model</strong>: LSTM-all-weather-portfolio</li>
<li><strong>Model Update Frequency</strong>: Low. Update the model only if it achieves a 5% annualized return</li>
<li><strong>Recommended Solution</strong>: <code>Batch-transform endpoint</code></li>
</ul>
<p><img src="/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/batch-transform-endpoint.png" alt="Batch-transform endpoint"></p>
<p>If the dataset is large and response time can be delayed, the <code>Batch-transform endpoint</code> should be used.</p>
<p><strong>Alice’s Intraday Futures Trading Strategy</strong></p>
<ul>
<li><strong>Assets</strong>: Index Futures</li>
<li><strong>Instrument Pool</strong>: SP500 index Future, Nasdaq Index Future</li>
<li><strong>Trading Frequency</strong>: 5 trades per day</li>
<li><strong>Response Time</strong>: Real-time</li>
<li><strong>Model</strong>: LSTM-Pure-Alpha-Future</li>
<li><strong>Model Update Frequency</strong>: High. Always optimization of buy and exit signals</li>
<li><strong>Recommended Solution</strong>: <code>Real-time endpoint</code></li>
</ul>
<p><img src="/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/real-time-endpoint.png" alt="Real-time endpoint"></p>
<p>If the dataset is small and response time needs to be fast, the <code>Real-time endpoint</code> should be used.</p>
<hr>
<h2 id="Even-though-Sagemaker-provides-various-deployment-benefits-why-do-I-still-use-EC2"><a href="#Even-though-Sagemaker-provides-various-deployment-benefits-why-do-I-still-use-EC2" class="headerlink" title="Even though Sagemaker provides various deployment benefits, why do I still use EC2?"></a>Even though Sagemaker provides various deployment benefits, why do I still use EC2?</h2><p>In my current role at a financial technology company, I am always excited about innovative products. AWS’s innovative products bring surprising solutions. If I were to create a personal music brand, I would choose AWS’s new products such as DeepComposer, Fargate, Amplify, Lambda, etc.</p>
<p>However, the cost of migrating to the cloud is high. Additionally, there is no significant incentive to migrate existing hardware resources to the cloud. Here are my use cases to explain why I choose EC2:</p>
<p><img src="/blog.aws/images/even-though-sagemaker-provides-various-benefits-why-do-i-still-use-ec2/benefits-001.png" alt="Even though Sagemaker provides various deployment benefits, why do I still use EC2?"></p>
<p><strong>1. Custom Python financial engineering library</strong></p>
<p>Although I prefer to use frameworks and libraries, there are some special requirements that require the use of a custom Python financial engineering library, such as developing high dividend investment strategies, macro cross-market analysis, and so on. Therefore, I manage Docker images. Thus, the pre-built images provided by Sagemaker cannot fully meet my needs, and instead, EC2 offers more freedom to structure the production environment.</p>
<p><strong>2. Team development and custom CI&#x2F;CD workflow</strong></p>
<p>Although Sagemaker allows for quick training and deployment of models, it does not fully meet my development needs. We have an independent development team responsible for researching trading strategies and developing deep learning trading models. Due to our custom CI&#x2F;CD workflow, it is not suitable to overly rely on Sagemaker for architecture.</p>
<p><strong>3. Pursuit of controlled fixed costs</strong></p>
<p>Although Sagemaker and Fargate allow for quick creation of instances, the cost is based on CPU utilization. Therefore, I prefer EC2 with fixed costs and manually scale up when resources are insufficient.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Sagemaker is a remarkable product. For startup companies looking to launch new products, AWS’s cloud solution is the preferred choice. Even for mature enterprises, leveraging AWS cloud services can optimize workflow. In summary, I highly recommend incorporating Sagemaker into the development process.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/09/13/why-choose-sagemaker-despite-having-a-local-server-with-rtx3080/" rel="prev" title="Why Choose Sagemaker Despite Having a Local Server with RTX3080?">
      <i class="fa fa-chevron-left"></i> Why Choose Sagemaker Despite Having a Local Server with RTX3080?
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/12/05/machine-learning-trading-strategy-best-practices-for-aws-sagemaker/" rel="next" title="Machine Learning Trading Strategy Best Practices for AWS SageMaker">
      Machine Learning Trading Strategy Best Practices for AWS SageMaker <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sagemaker-Exec-Training-and-Deploying-Models-Locally"><span class="nav-number">2.</span> <span class="nav-text">Sagemaker Exec - Training and Deploying Models Locally</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#When-to-use-real-time-endpoints-and-batch-transform-endpoints"><span class="nav-number">3.</span> <span class="nav-text">When to use real-time endpoints and batch-transform endpoints</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Even-though-Sagemaker-provides-various-deployment-benefits-why-do-I-still-use-EC2"><span class="nav-number">4.</span> <span class="nav-text">Even though Sagemaker provides various deployment benefits, why do I still use EC2?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">5.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Kenny Chen"
      src="/images/icon/ic_avatar_001.jpg">
  <p class="site-author-name" itemprop="name">Kenny Chen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/kenny-chen-a560a8241" title="Linkin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;kenny-chen-a560a8241" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i>Linkin</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://dev.to/kennc" title="https:&#x2F;&#x2F;dev.to&#x2F;kennc" rel="noopener" target="_blank">Dev.to</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/chenkuang" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;chenkuang" rel="noopener" target="_blank">Cnblogs</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kenny Chen</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
